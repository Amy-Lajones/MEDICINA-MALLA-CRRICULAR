<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Malla Curricular Medicina</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f6f9;
      margin: 0;
      padding: 1rem;
    }
    h1 {
      text-align: center;
      color: #34495e;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(11, 1fr);
      gap: 1rem;
      margin-top: 2rem;
      overflow-x: auto;
    }
    .column {
      background: #ecf0f1;
      padding: 0.5rem;
      border-radius: 10px;
      min-width: 200px;
    }
    .column h2 {
      text-align: center;
      font-size: 1.1rem;
      color: #2c3e50;
    }
    .subject {
      background: #ffffff;
      border: 1px solid #bdc3c7;
      border-radius: 6px;
      padding: 0.4rem;
      margin: 0.4rem 0;
      cursor: pointer;
      position: relative;
      user-select: none;
      transition: background-color 0.2s;
    }
    .subject.locked {
      background: #e0e0e0;
      color: #999;
      cursor: not-allowed;
    }
    .subject.locked::after {
      content: attr(data-tooltip);
      position: absolute;
      left: 100%;
      top: 50%;
      transform: translateY(-50%);
      background: #34495e;
      color: white;
      padding: 0.3rem 0.6rem;
      border-radius: 5px;
      font-size: 0.8rem;
      white-space: nowrap;
      display: none;
    }
    .subject.locked:hover::after {
      display: block;
    }
    .subject.approved {
      background-color: #a2d5ab;
      text-decoration: line-through;
    }
    .components {
      margin-top: 3rem;
      background-color: #e8f0fe;
      padding: 1rem;
      border-radius: 10px;
    }
    .components h2 {
      color: #1a73e8;
    }
    .components ul {
      list-style: none;
      padding-left: 0;
    }
    .components li {
      margin: 0.5rem 0;
      padding: 0.5rem;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 6px;
      cursor: pointer;
    }
    .components li.approved {
      background-color: #a2d5ab;
      text-decoration: line-through;
    }
  </style>
</head>
<body>
  <h1>Malla Curricular - Medicina</h1>
  <div class="grid" id="malla"></div>

  <div class="components">
    <h2>Componentes Adicionales</h2>
    <ul id="componentes">
      <li data-id="comp1">Computación I</li>
      <li data-id="comp2">Computación II</li>
      <li data-id="comp3">Computación III</li>
      <li data-id="ing1">Inglés I</li>
      <li data-id="ing2">Inglés II</li>
      <li data-id="ing3">Inglés III</li>
      <li data-id="ing4">Inglés IV</li>
      <li data-id="inte">Unidad de integración curricular</li>
    </ul>
  </div>

  <script>
    const subjects = [
      // Lista completa generada en pasos anteriores (semestres 1 al 11)...
      // Para mantener claridad aquí no la vuelvo a copiar entera,
      // pero tú ya la tienes en la versión más reciente del documento.
    ];

    const componentes = [
      { id: "comp1", name: "Computación I" },
      { id: "comp2", name: "Computación II" },
      { id: "comp3", name: "Computación III" },
      { id: "ing1", name: "Inglés I" },
      { id: "ing2", name: "Inglés II" },
      { id: "ing3", name: "Inglés III" },
      { id: "ing4", name: "Inglés IV" },
      { id: "inte", name: "Unidad de integración curricular" },
    ];

    const approved = new Set(JSON.parse(localStorage.getItem("aprobadas") || "[]"));

    function saveProgress() {
      localStorage.setItem("aprobadas", JSON.stringify([...approved]));
    }

    function createMalla() {
      const container = document.getElementById("malla");
      for (let i = 1; i <= 11; i++) {
        const col = document.createElement("div");
        col.className = "column";
        const title = document.createElement("h2");
        title.textContent = `Semestre ${i}`;
        col.appendChild(title);

        subjects.filter(s => s.semester === i).forEach(subject => {
          const div = document.createElement("div");
          div.className = "subject";
          div.textContent = subject.name;
          div.dataset.id = subject.id;

          const missing = subject.prereqs.filter(p => !approved.has(p));
          if (missing.length) {
            div.classList.add("locked");
            const missingNames = missing.map(m => {
              const found = subjects.find(s => s.id === m);
              return found ? found.name : m;
            });
            div.dataset.tooltip = `Falta: ${missingNames.join(", ")}`;
          } else {
            if (approved.has(subject.id)) {
              div.classList.add("approved");
            }
            div.addEventListener("click", () => {
              if (div.classList.contains("approved")) {
                approved.delete(subject.id);
                div.classList.remove("approved");
              } else {
                approved.add(subject.id);
                div.classList.add("approved");
              }
              saveProgress();
              location.reload();
            });
          }

          col.appendChild(div);
        });

        container.appendChild(col);
      }
    }

    function createComponentes() {
      const ul = document.getElementById("componentes");
      ul.querySelectorAll("li").forEach(li => {
        const id = li.dataset.id;
        if (approved.has(id)) {
          li.classList.add("approved");
        }
        li.addEventListener("click", () => {
          if (approved.has(id)) {
            approved.delete(id);
            li.classList.remove("approved");
          } else {
            approved.add(id);
            li.classList.add("approved");
          }
          saveProgress();
        });
      });
    }

    createMalla();
    createComponentes();
  </script>
</body>
</html>
